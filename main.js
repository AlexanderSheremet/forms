(()=>{"use strict";const t={popover:{valueMissing:"It's necessary to write text"},email:{valueMissing:"It's necessary to write email",typeMismatch:"It's not email!"},name:{valueMissing:"It's necessary to write text"},cost:{valueMissing:"It's necessary to write cost",rangeUnderflow:"Enter a number greater than 0"}};function e(t,e){t.forEach((t=>{const s=t.dataset?t.dataset.id:null,{value:o}=t;s&&(e[s]=o)}))}class s{constructor(t,e){this.row=e,this.dataProduct=t,this.bindToDOM()}bindToDOM(){this.row.innerHTML=`\n    <th class="product-name">${this.dataProduct.name}</th>\n    <th class="product-cost">${+this.dataProduct.cost}</th>\n    <th><span class="update">✎</span><span class="delete">✖</span></th>\n    `}events(t){const e=t.querySelector(".update"),s=t.querySelector(".delete");e.addEventListener("click",(()=>this.update(this.dataProduct))),s.addEventListener("click",(()=>this.delete()))}update(t){const e=document.querySelector("#editor-form");e.setAttribute("data-id",t.id),e.closest(".editor-form-container").classList.add("editor-form-container_visible");const s=e.querySelector('[data-id="name"]'),o=e.querySelector('[data-id="cost"]');s.value=t.name,o.value=t.cost}delete(){this._deleteMessage=document.querySelector(".delete-message"),this._deleteMessage.classList.add("delete-message_visible"),this._deleteMessage.setAttribute("data-id",this.dataProduct.id);const t=document.querySelector("tbody").getBoundingClientRect();this._deleteMessage.style.left=t.left+window.scrollX+t.width/2-this._deleteMessage.offsetWidth/2+"px",this._deleteMessage.style.top=`${t.top+window.scrollY}px`}markUp(){return this.row.innerHTML}}const o=[];class i{constructor(){this._tooltips=[]}showTooltip(t,e){const s=document.createElement("DIV");s.classList.add("form-error"),s.textContent=t;const o=performance.now();this._tooltips.push({id:o,element:s}),document.body.appendChild(s);const{left:i,bottom:n}=e.getBoundingClientRect();return s.style.left=`${window.scrollX+i}px`,s.style.top=`${n+5}px`,o}removeTooltip(t){this._tooltips.find((e=>e.id===t)).element.remove(),this._tooltips=this._tooltips.filter((e=>e.id!==t))}}const n=(t,e)=>{const s=Object.keys(ValidityState.prototype).find((e=>!!t.name&&("valid"!==e&&t.validity[e])));return!!s&&e[t.name][s]};class r{constructor(t){this._container=t,this._formContainer=null,this._errorElement=null,this._form=null,this._tooltipFactory=new i,this.productsArray=[],this.actualMessages=[]}bindToDOM(t){this.createFormContainer(t||{name:"",cost:""}),this.setEvents()}createFormContainer(t){this._formContainer=document.createElement("div"),this._formContainer.classList.add("editor-form-container"),this.setFormData(t),this._formContainer.innerHTML=r.formMarkup(this.formData),this._container.append(this._formContainer),this._form=this._container.querySelector("#editor-form"),this._errorElement=this._container.querySelector(".editor-form-error")}setFormData(t){this.formData=t}setEvents(){this._form.querySelector('[data-toggle="editor-close"]').addEventListener("click",(()=>this.closeForm())),this._form.addEventListener("submit",(t=>this.onSubmit(t))),this._form.addEventListener("focus",(()=>{}),!0),this._form.addEventListener("blur",(t=>this.elementOnBlur(t)),!0)}elementOnBlur(e){const s=e.target,o=n(s,t),i=this.actualMessages.findIndex((t=>t.name===s.name));o?-1===i&&this.showTooltip(o,s):-1!==i&&(this._tooltipFactory.removeTooltip(this.actualMessages[i].id),this.actualMessages.splice(i,1))}closeForm(){this._form.dataset.id&&this._form.removeAttribute("data-id"),this._form.reset(),this._formContainer.classList.remove("editor-form-container_visible")}onSubmit(t){t.preventDefault(),this.handleValidation()}handleValidation(){this.formElements=[...this._form.elements],this.actualMessages.forEach((t=>this._tooltipFactory.removeTooltip(t.id))),this.actualMessages=[],this._form.checkValidity()?this.processFormData():this.showErrors()}showErrors(){this.formElements.forEach((e=>{const s=n(e,t);s&&this.showTooltip(s,e)}))}processFormData(){this._form.dataset.id?this.updateProduct():this.createProduct(),this.closeForm()}updateProduct(){const t=+this._form.dataset.id,s=o.findIndex((e=>e.id===t)),i=o[s];e(this.formElements,i);const n=this._container.querySelector(`[data-row="${t}"]`);n.querySelector(".product-name").innerText=i.name,n.querySelector(".product-cost").innerText=i.cost}createProduct(){const t={};e(this.formElements,t),t.id=Date.now();const i=this._container.querySelector("tbody"),n=document.createElement("tr"),r=new s(t,n);o.push(r.dataProduct),n.classList.add("product-row"),n.innerHTML=r.markUp(),n.setAttribute("data-row",t.id),r.events(n),i.append(n)}showTooltip(t,e){this.actualMessages.push({name:e.name,id:this._tooltipFactory.showTooltip(t,e)})}static formMarkup(t){return`\n            <form id="editor-form" novalidate>\n                <div class="form-control form-editor">\n                  <label class="label-editor" for="name">Название</label>\n                  <input name="name" data-id="name" class="input input-editor" type="text" placeholder="product name" autocomplete="off" value="${t.name}" required> \n                </div>\n                <div class="form-control form-editor">\n                  <label for="cost" class="label-editor">Стоимость</label>\n                  <input name="cost" data-id="cost" class="input input-editor" type="number" min="1" placeholder="product cost" autocomplete="off" value="${t.cost}" required>\n                </div>\n\n                <div class="editor-btn">\n                  <button type="submit" class="btn btn-add" data-toggle="editor-add" title="Submit editor form">Сохранить</button>\n                  <button type="button" class="btn btn-close" data-toggle="editor-close" title="Close editor form">Закрыть</button>\n                </div>\n              </form>\n          `}}class a{constructor(){this._container=null}bindToDOM(t){this._container=t,this.drawUi(),this.setEventListeners()}drawUi(){this.isBound()&&(this._container.innerHTML=a.markUp)}isBound(){return null!==this._container}setEventListeners(){if(!this.isBound())return;this._container.querySelector(".btn").addEventListener("click",(t=>this.onClick(t)))}static get markUp(){return'\n      <div class="wrapper-btn">\n        <a tabindex="0" role="button" class="btn" data-toggle="popover" title="Popover title" data-content="And here\'s some amazing content?">Click to toggle popover</a>\n      </div>\n      <div class="popover-message">\n        <h3 class="popover-title">Popover title</h3>\n        <p class="popover-text">And here\'s some amazing content. It\'s very engaging. Right?"</p>\n      </div>\n    '}onClick(t){this.popoverMessage=this._container.querySelector(".popover-message"),this.popoverMessage.classList.toggle("popover-message_visible"),this.positionPopoverMessage(t)}positionPopoverMessage(t){const e=t.currentTarget.getBoundingClientRect(),s=this.popoverMessage.getBoundingClientRect(),o=e.left+e.width/2-s.width/2+window.scrollX,i=e.top-s.height-20+window.scrollY;this.popoverMessage.style.left=`${o}px`,this.popoverMessage.style.top=`${i}px`}}console.log("it works!");(new a).bindToDOM(document.querySelector("#popover-container"));(new class{constructor(){this._container=null,this.editorForm=null,this.deleteMessage=null,this.products=o}bindToDOM(t){this._container=t,this.drawUi(),this.events()}drawUi(){this.checkBinding(),this._container.innerHTML='\n      <table class="table">\n        <caption class="title-table">My editor</caption>\n        <thead>\n          <tr class="products">\n            <th  colspan="2" style="text-align:left">Товары</th>\n            <th style="text-align:right" data-id="add"><span class="add">✙</span></th>\n          </tr>\n          <tr class="product-table">\n            <th>Название</th>\n            <th>Стоимость</th>\n            <th>Действия</th>\n          </tr>\n        </thead>\n        <tbody></tbody>\n      </table>\n      <div class="delete-message">\n        <h2>Вы действительно хотите удалить товар?</h2>\n        <div class="editor-btn">\n          <button type="button" class="btn btn-add" data-toggle="delete-product" title="Button for delete product">Да</button>\n          <button type="button" class="btn btn-close" data-toggle="close-message" title="Close delete message">Нет</button>\n        </div>\n      </div>\n      ';new r(this._container).bindToDOM(),this.editorForm=this._container.querySelector(".editor-form-container"),this.deleteMessage=this._container.querySelector(".delete-message")}checkBinding(){if(null===this._container)throw new Error("Form not bind to DOM")}events(){const t=this._container.querySelector('[data-id="add"]'),e=this._container.querySelector('[data-toggle="delete-product"]'),s=this._container.querySelector('[data-toggle="close-message"]');t.addEventListener("click",(()=>this.showForm())),e.addEventListener("click",(t=>this.deleteProduct(t))),s.addEventListener("click",(()=>this.closeMessage()))}showForm(){this.editorForm.classList.add("editor-form-container_visible");const t=this._container.querySelector("tbody").getBoundingClientRect();this.editorForm.style.left=t.left+window.scrollX+t.width/2-this.editorForm.offsetWidth/2+"px",this.editorForm.style.top=`${t.top+window.scrollY}px`}deleteProduct(){const t=o.findIndex((t=>t.id===+this.deleteMessage.dataset.id));o.splice(t,1);const e=this._container.querySelector(`[data-row="${this.deleteMessage.dataset.id}"]`);e.parentNode.removeChild(e),this.closeMessage()}closeMessage(){this.deleteMessage.classList.remove("delete-message_visible")}}).bindToDOM(document.querySelector("#editor-container"))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQUEsTUFpQkEsRUFqQmlCLENBQ2ZBLFFBQVMsQ0FDUEMsYUFBYyxnQ0FFaEJDLE1BQU8sQ0FDTEQsYUFBYyxnQ0FDZEUsYUFBYyxtQkFFaEJDLEtBQU0sQ0FDSkgsYUFBYyxnQ0FFaEJJLEtBQU0sQ0FDSkosYUFBYywrQkFDZEssZUFBZ0Isa0NDYkwsU0FBU0MsRUFBV0MsRUFBT0MsR0FDeENELEVBQU1FLFNBQVNDLElBQ2IsTUFBTUMsRUFBTUQsRUFBR0UsUUFBVUYsRUFBR0UsUUFBUUMsR0FBSyxNQUNuQyxNQUFFQyxHQUFVSixFQUViQyxJQUVMSCxFQUFFRyxHQUFPRyxFQUFLLEdBRWxCLENDVGUsTUFBTUMsRUFDbkJDLFdBQUFBLENBQVlDLEVBQU1DLEdBQ2hCQyxLQUFLQyxJQUFNRixFQUNYQyxLQUFLRSxZQUFjSixFQUNuQkUsS0FBS0csV0FDUCxDQUVBQSxTQUFBQSxHQUNFSCxLQUFLQyxJQUFJRyxVQUFhLGtDQUNLSixLQUFLRSxZQUFZbEIsNENBQ2hCZ0IsS0FBS0UsWUFBWWpCLDBGQUcvQyxDQUVBb0IsTUFBQUEsQ0FBT04sR0FDTCxNQUFNTyxFQUFZUCxFQUFVUSxjQUFjLFdBQ3BDQyxFQUFZVCxFQUFVUSxjQUFjLFdBRTFDRCxFQUFVRyxpQkFBaUIsU0FBUyxJQUFNVCxLQUFLVSxPQUFPVixLQUFLRSxlQUMzRE0sRUFBVUMsaUJBQWlCLFNBQVMsSUFBTVQsS0FBS1csVUFDakQsQ0FHQUQsTUFBQUEsQ0FBT1osR0FDTCxNQUFNYyxFQUFPQyxTQUFTTixjQUFjLGdCQUNwQ0ssRUFBS0UsYUFBYSxVQUFXaEIsRUFBS0osSUFFbENrQixFQUNHRyxRQUFRLDBCQUNSQyxVQUFVQyxJQUFJLGlDQUNqQixNQUFNQyxFQUFZTixFQUFLTCxjQUFjLG9CQUMvQlksRUFBWVAsRUFBS0wsY0FBYyxvQkFDckNXLEVBQVV2QixNQUFRRyxFQUFLZCxLQUN2Qm1DLEVBQVV4QixNQUFRRyxFQUFLYixJQUN6QixDQUVBMEIsU0FDRVgsS0FBS29CLGVBQWlCUCxTQUFTTixjQUFjLG1CQUM3Q1AsS0FBS29CLGVBQWVKLFVBQVVDLElBQUksMEJBQ2xDakIsS0FBS29CLGVBQWVOLGFBQWEsVUFBV2QsS0FBS0UsWUFBWVIsSUFFN0QsTUFBTTJCLEVBQVlSLFNBQVNOLGNBQWMsU0FBU2Usd0JBQ2xEdEIsS0FBS29CLGVBQWVHLE1BQU1DLEtBQVVILEVBQVVHLEtBQU9DLE9BQU9DLFFBQVVMLEVBQVVNLE1BQVEsRUFBSTNCLEtBQUtvQixlQUFlUSxZQUFjLEVBQTVGLEtBQ2xDNUIsS0FBS29CLGVBQWVHLE1BQU1NLElBQU8sR0FBRVIsRUFBVVEsSUFBTUosT0FBT0ssV0FDNUQsQ0FFQUMsTUFBQUEsR0FDRSxPQUFPL0IsS0FBS0MsSUFBSUcsU0FDbEIsRUNqREYsTUFDQSxFQURzQixHQ0VQLE1BQU00QixFQUNuQm5DLFdBQUFBLEdBQ0VHLEtBQUtpQyxVQUFZLEVBQ25CLENBRUFDLFdBQUFBLENBQVlDLEVBQVNDLEdBQ25CLE1BQU1DLEVBQWlCeEIsU0FBU3lCLGNBQWMsT0FFOUNELEVBQWVyQixVQUFVQyxJQUFJLGNBQzdCb0IsRUFBZUUsWUFBY0osRUFFN0IsTUFBTXpDLEVBQUs4QyxZQUFZQyxNQUV2QnpDLEtBQUtpQyxVQUFVUyxLQUFLLENBQ2xCaEQsS0FDQTBDLFFBQVNDLElBR1h4QixTQUFTOEIsS0FBS0MsWUFBWVAsR0FFMUIsTUFBTSxLQUFFYixFQUFJLE9BQUVxQixHQUFXVCxFQUFRZCx3QkFLakMsT0FIQWUsRUFBZWQsTUFBTUMsS0FBUSxHQUFFQyxPQUFPQyxRQUFVRixNQUNoRGEsRUFBZWQsTUFBTU0sSUFBTyxHQUFFZ0IsRUFBUyxNQUVoQ25ELENBQ1QsQ0FFQW9ELGFBQUFBLENBQWNwRCxHQUNJTSxLQUFLaUMsVUFBVWMsTUFBTUMsR0FBTUEsRUFBRXRELEtBQU9BLElBRTVDMEMsUUFBUWEsU0FFaEJqRCxLQUFLaUMsVUFBWWpDLEtBQUtpQyxVQUFVaUIsUUFBUUYsR0FBTUEsRUFBRXRELEtBQU9BLEdBQ3pELEVDcENGLE1BYUEsRUFiaUJ5RCxDQUFDNUQsRUFBSTZELEtBQ3BCLE1BQU1DLEVBQVdDLE9BQU9DLEtBQUtDLGNBQWNDLFdBQVdWLE1BQU12RCxLQUNyREQsRUFBR1AsT0FDSSxVQUFSUSxHQUVHRCxFQUFHbUUsU0FBU2xFLE1BR3JCLFFBQUs2RCxHQUVFRCxFQUFPN0QsRUFBR1AsTUFBTXFFLEVBQVMsRUNEbkIsTUFBTU0sRUFDbkI5RCxXQUFBQSxDQUFZRSxHQUNWQyxLQUFLNEQsV0FBYTdELEVBQ2xCQyxLQUFLNkQsZUFBaUIsS0FDdEI3RCxLQUFLOEQsY0FBZ0IsS0FDckI5RCxLQUFLK0QsTUFBUSxLQUNiL0QsS0FBS2dFLGdCQUFrQixJQUFJaEMsRUFFM0JoQyxLQUFLaUUsY0FBZ0IsR0FDckJqRSxLQUFLa0UsZUFBaUIsRUFDeEIsQ0FFQS9ELFNBQUFBLENBQVVMLEdBQ1JFLEtBQUttRSxvQkFBb0JyRSxHQUFRLENBQUVkLEtBQU0sR0FBSUMsS0FBTSxLQUNuRGUsS0FBS29FLFdBQ1AsQ0FFQUQsbUJBQUFBLENBQW9CckUsR0FDbEJFLEtBQUs2RCxlQUFpQmhELFNBQVN5QixjQUFjLE9BQzdDdEMsS0FBSzZELGVBQWU3QyxVQUFVQyxJQUFJLHlCQUNsQ2pCLEtBQUtxRSxZQUFZdkUsR0FDakJFLEtBQUs2RCxlQUFlekQsVUFBWXVELEVBQVdXLFdBQVd0RSxLQUFLdUUsVUFDM0R2RSxLQUFLNEQsV0FBV1ksT0FBT3hFLEtBQUs2RCxnQkFDNUI3RCxLQUFLK0QsTUFBUS9ELEtBQUs0RCxXQUFXckQsY0FBYyxnQkFDM0NQLEtBQUs4RCxjQUFnQjlELEtBQUs0RCxXQUFXckQsY0FBYyxxQkFDckQsQ0FFQThELFdBQUFBLENBQVl2RSxHQUNWRSxLQUFLdUUsU0FBV3pFLENBQ2xCLENBRUFzRSxTQUFBQSxHQUNtQnBFLEtBQUsrRCxNQUFNeEQsY0FBYyxnQ0FFakNFLGlCQUFpQixTQUFTLElBQU1ULEtBQUt5RSxjQUM5Q3pFLEtBQUsrRCxNQUFNdEQsaUJBQWlCLFVBQVdpRSxHQUFNMUUsS0FBSzJFLFNBQVNELEtBQzNEMUUsS0FBSytELE1BQU10RCxpQkFBaUIsU0FBUyxTQUFVLEdBQy9DVCxLQUFLK0QsTUFBTXRELGlCQUFpQixRQUFTaUUsR0FBTTFFLEtBQUs0RSxjQUFjRixLQUFJLEVBQ3BFLENBRUFFLGFBQUFBLENBQWNGLEdBQ1osTUFBTW5GLEVBQUttRixFQUFFRyxPQUNQQyxFQUFRM0IsRUFBUzVELEVBQUl3RixHQUVyQkMsRUFBZWhGLEtBQUtrRSxlQUFlZSxXQUN0Q0MsR0FBU0EsRUFBS2xHLE9BQVNPLEVBQUdQLE9BR3pCOEYsR0FDb0IsSUFBbEJFLEdBQ0ZoRixLQUFLa0MsWUFBWTRDLEVBQU92RixJQUVDLElBQWxCeUYsSUFDVGhGLEtBQUtnRSxnQkFBZ0JsQixjQUNuQjlDLEtBQUtrRSxlQUFlYyxHQUFjdEYsSUFFcENNLEtBQUtrRSxlQUFlaUIsT0FBT0gsRUFBYyxHQUU3QyxDQUVBUCxTQUFBQSxHQUNNekUsS0FBSytELE1BQU10RSxRQUFRQyxJQUFJTSxLQUFLK0QsTUFBTXFCLGdCQUFnQixXQUV0RHBGLEtBQUsrRCxNQUFNc0IsUUFDWHJGLEtBQUs2RCxlQUFlN0MsVUFBVWlDLE9BQU8sZ0NBQ3ZDLENBRUEwQixRQUFBQSxDQUFTRCxHQUNQQSxFQUFFWSxpQkFDRnRGLEtBQUt1RixrQkFDUCxDQUVBQSxnQkFBQUEsR0FDRXZGLEtBQUt3RixhQUFlLElBQUl4RixLQUFLK0QsTUFBTTBCLFVBRW5DekYsS0FBS2tFLGVBQWU1RSxTQUFTNkMsR0FBWW5DLEtBQUtnRSxnQkFBZ0JsQixjQUFjWCxFQUFRekMsTUFFcEZNLEtBQUtrRSxlQUFpQixHQUVqQmxFLEtBQUsrRCxNQUFNMkIsZ0JBR2QxRixLQUFLMkYsa0JBRkwzRixLQUFLNEYsWUFJVCxDQUVBQSxVQUFBQSxHQUNFNUYsS0FBS3dGLGFBQWFsRyxTQUFTdUcsSUFDekIsTUFBTWYsRUFBUTNCLEVBQVMwQyxFQUFNZCxHQUN6QkQsR0FDRjlFLEtBQUtrQyxZQUFZNEMsRUFBT2UsRUFDMUIsR0FFSixDQUVBRixlQUFBQSxHQUNNM0YsS0FBSytELE1BQU10RSxRQUFRQyxHQUNyQk0sS0FBSzhGLGdCQUVMOUYsS0FBSytGLGdCQUVQL0YsS0FBS3lFLFdBQ1AsQ0FFQXFCLGFBQUFBLEdBQ0UsTUFBTXBHLEdBQU1NLEtBQUsrRCxNQUFNdEUsUUFBUUMsR0FDekJzRyxFQUFRL0IsRUFBY2dCLFdBQVcxRixHQUFPQSxFQUFHRyxLQUFPQSxJQUNsRHVHLEVBQWNoQyxFQUFjK0IsR0FFbEM3RyxFQUFXYSxLQUFLd0YsYUFBY1MsR0FFOUIsTUFBTUMsRUFBVWxHLEtBQUs0RCxXQUFXckQsY0FBZSxjQUFhYixPQUM1RHdHLEVBQVEzRixjQUFjLGlCQUFpQjRGLFVBQVlGLEVBQVlqSCxLQUMvRGtILEVBQVEzRixjQUFjLGlCQUFpQjRGLFVBQVlGLEVBQVloSCxJQUNqRSxDQUVBOEcsYUFBQUEsR0FDRSxNQUFNeEIsRUFBVyxDQUFDLEVBQ2xCcEYsRUFBV2EsS0FBS3dGLGFBQWNqQixHQUU5QkEsRUFBUzdFLEdBQUswRyxLQUFLM0QsTUFFbkIsTUFBTTRELEVBQVlyRyxLQUFLNEQsV0FBV3JELGNBQWMsU0FDMUMrRixFQUFXekYsU0FBU3lCLGNBQWMsTUFDbEM0RCxFQUFVLElBQUl0RyxFQUFRMkUsRUFBVStCLEdBRXRDckMsRUFBY3ZCLEtBQUt3RCxFQUFRaEcsYUFFM0JvRyxFQUFTdEYsVUFBVUMsSUFBSSxlQUN2QnFGLEVBQVNsRyxVQUFZOEYsRUFBUW5FLFNBQzdCdUUsRUFBU3hGLGFBQWEsV0FBWXlELEVBQVM3RSxJQUMzQ3dHLEVBQVE3RixPQUFPaUcsR0FDZkQsRUFBVTdCLE9BQU84QixFQUNuQixDQUVBcEUsV0FBQUEsQ0FBWUMsRUFBUzVDLEdBQ25CUyxLQUFLa0UsZUFBZXhCLEtBQUssQ0FDdkIxRCxLQUFNTyxFQUFHUCxLQUNUVSxHQUFJTSxLQUFLZ0UsZ0JBQWdCOUIsWUFBWUMsRUFBUzVDLElBRWxELENBRUEsaUJBQU8rRSxDQUFXQyxHQUNoQixNQUFRLHdVQUlzSUEsRUFBU3ZGLDJVQUlDdUYsRUFBU3RGLHlaQVNuSyxFQ3ZLYSxNQUFNc0gsRUFDbkIxRyxXQUFBQSxHQUNFRyxLQUFLNEQsV0FBYSxJQUNwQixDQUVBekQsU0FBQUEsQ0FBVUosR0FDUkMsS0FBSzRELFdBQWE3RCxFQUNsQkMsS0FBS3dHLFNBQ0x4RyxLQUFLeUcsbUJBQ1AsQ0FFQUQsTUFBQUEsR0FDT3hHLEtBQUswRyxZQUVWMUcsS0FBSzRELFdBQVd4RCxVQUFZbUcsRUFBUXhFLE9BQ3RDLENBRUEyRSxPQUFBQSxHQUNFLE9BQXdCLE9BQXBCMUcsS0FBSzRELFVBSVgsQ0FFQTZDLGlCQUFBQSxHQUNFLElBQUt6RyxLQUFLMEcsVUFBVyxPQUVDMUcsS0FBSzRELFdBQVdyRCxjQUFjLFFBQ3RDRSxpQkFBaUIsU0FBVWlFLEdBQU0xRSxLQUFLMkcsUUFBUWpDLElBQzlELENBRUEsaUJBQVczQyxHQUNULE1BQVEsZ2JBU1YsQ0FFQTRFLE9BQUFBLENBQVFqQyxHQUNOMUUsS0FBSzRHLGVBQWlCNUcsS0FBSzRELFdBQVdyRCxjQUFjLG9CQUNwRFAsS0FBSzRHLGVBQWU1RixVQUFVNkYsT0FBTywyQkFDckM3RyxLQUFLOEcsdUJBQXVCcEMsRUFDOUIsQ0FFQW9DLHNCQUFBQSxDQUF1QnBDLEdBQ3JCLE1BQU1xQyxFQUFTckMsRUFBRXNDLGNBQWMxRix3QkFDekIyRixFQUFxQmpILEtBQUs0RyxlQUFldEYsd0JBRXpDRSxFQUFPdUYsRUFBT3ZGLEtBQU91RixFQUFPcEYsTUFBUSxFQUFJc0YsRUFBbUJ0RixNQUFRLEVBQUlGLE9BQU9DLFFBQzlFRyxFQUFNa0YsRUFBT2xGLElBQU1vRixFQUFtQkMsT0FBUyxHQUFLekYsT0FBT0ssUUFFakU5QixLQUFLNEcsZUFBZXJGLE1BQU1DLEtBQVEsR0FBRUEsTUFDcEN4QixLQUFLNEcsZUFBZXJGLE1BQU1NLElBQU8sR0FBRUEsS0FDckMsRUN4REZzRixRQUFRQyxJQUFJLGNBR0ksSUFBSWIsR0FDWnBHLFVBQVVVLFNBQVNOLGNBQWMsd0JBRzFCLElDTkEsTUFDYlYsV0FBQUEsR0FDRUcsS0FBSzRELFdBQWEsS0FDbEI1RCxLQUFLcUgsV0FBYSxLQUNsQnJILEtBQUtzSCxjQUFnQixLQUNyQnRILEtBQUt1SCxTQUFXdEQsQ0FDbEIsQ0FFQTlELFNBQUFBLENBQVVKLEdBQ1JDLEtBQUs0RCxXQUFhN0QsRUFFbEJDLEtBQUt3RyxTQUNMeEcsS0FBS0ssUUFDUCxDQUVBbUcsTUFBQUEsR0FDRXhHLEtBQUt3SCxlQUVMeEgsS0FBSzRELFdBQVd4RCxVQUFhLHk2QkF5QlYsSUFBSXVELEVBQVczRCxLQUFLNEQsWUFDNUJ6RCxZQUVYSCxLQUFLcUgsV0FBYXJILEtBQUs0RCxXQUFXckQsY0FBYywwQkFDaERQLEtBQUtzSCxjQUFnQnRILEtBQUs0RCxXQUFXckQsY0FBYyxrQkFDckQsQ0FFQWlILFlBQUFBLEdBQ0UsR0FBd0IsT0FBcEJ4SCxLQUFLNEQsV0FDUCxNQUFNLElBQUk2RCxNQUFNLHVCQUVwQixDQUVBcEgsTUFBQUEsR0FDRSxNQUFNcUgsRUFBUTFILEtBQUs0RCxXQUFXckQsY0FBYyxtQkFDdENvSCxFQUFnQjNILEtBQUs0RCxXQUFXckQsY0FDcEMsa0NBRUlxSCxFQUFlNUgsS0FBSzRELFdBQVdyRCxjQUNuQyxpQ0FHRm1ILEVBQU1qSCxpQkFBaUIsU0FBUyxJQUFNVCxLQUFLNkgsYUFDM0NGLEVBQWNsSCxpQkFBaUIsU0FBVWlFLEdBQU0xRSxLQUFLMkgsY0FBY2pELEtBQ2xFa0QsRUFBYW5ILGlCQUFpQixTQUFTLElBQU1ULEtBQUs0SCxnQkFDcEQsQ0FFQUMsUUFBQUEsR0FDRTdILEtBQUtxSCxXQUFXckcsVUFBVUMsSUFBSSxpQ0FFOUIsTUFBTThGLEVBQVMvRyxLQUFLNEQsV0FBV3JELGNBQWMsU0FBU2Usd0JBQ3REdEIsS0FBS3FILFdBQVc5RixNQUFNQyxLQUFVdUYsRUFBT3ZGLEtBQU9DLE9BQU9DLFFBQVVxRixFQUFPcEYsTUFBUSxFQUFJM0IsS0FBS3FILFdBQVd6RixZQUFjLEVBQWxGLEtBQzlCNUIsS0FBS3FILFdBQVc5RixNQUFNTSxJQUFPLEdBQUVrRixFQUFPbEYsSUFBTUosT0FBT0ssV0FDckQsQ0FFQTZGLGFBQUFBLEdBQ0UsTUFBTTNCLEVBQVEvQixFQUFjZ0IsV0FDekIxRixHQUFPQSxFQUFHRyxNQUFRTSxLQUFLc0gsY0FBYzdILFFBQVFDLEtBRWhEdUUsRUFBY2tCLE9BQU9hLEVBQU8sR0FFNUIsTUFBTUUsRUFBVWxHLEtBQUs0RCxXQUFXckQsY0FDN0IsY0FBYVAsS0FBS3NILGNBQWM3SCxRQUFRQyxRQUUzQ3dHLEVBQVE0QixXQUFXQyxZQUFZN0IsR0FDL0JsRyxLQUFLNEgsY0FDUCxDQUVBQSxZQUFBQSxHQUNFNUgsS0FBS3NILGNBQWN0RyxVQUFVaUMsT0FBTyx5QkFDdEMsSUR0Rks5QyxVQUFVVSxTQUFTTixjQUFjLHFCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZm9ybXMvLi9zcmMvanMvRWRpdG9yL0VkaXRvckZvcm0vbWVzc2FnZXMuanMiLCJ3ZWJwYWNrOi8vZm9ybXMvLi9zcmMvanMvRWRpdG9yL2NyZWF0ZURhdGEuanMiLCJ3ZWJwYWNrOi8vZm9ybXMvLi9zcmMvanMvRWRpdG9yL1Byb2R1Y3QuanMiLCJ3ZWJwYWNrOi8vZm9ybXMvLi9zcmMvanMvRWRpdG9yL3Byb2R1Y3RzQXJyYXkuanMiLCJ3ZWJwYWNrOi8vZm9ybXMvLi9zcmMvanMvRWRpdG9yL1Rvb2x0aXAvVG9vbHRpcC5qcyIsIndlYnBhY2s6Ly9mb3Jtcy8uL3NyYy9qcy9FZGl0b3IvVG9vbHRpcC9nZXRFcnJvci5qcyIsIndlYnBhY2s6Ly9mb3Jtcy8uL3NyYy9qcy9FZGl0b3IvRWRpdG9yRm9ybS9FZGl0b3JGb3JtLmpzIiwid2VicGFjazovL2Zvcm1zLy4vc3JjL2pzL1BvcG92ZXIvUG9wb3Zlci5qcyIsIndlYnBhY2s6Ly9mb3Jtcy8uL3NyYy9qcy9hcHAuanMiLCJ3ZWJwYWNrOi8vZm9ybXMvLi9zcmMvanMvRWRpdG9yL0VkaXRvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtZXNzYWdlcyA9IHtcbiAgcG9wb3Zlcjoge1xuICAgIHZhbHVlTWlzc2luZzogXCJJdCdzIG5lY2Vzc2FyeSB0byB3cml0ZSB0ZXh0XCIsXG4gIH0sXG4gIGVtYWlsOiB7XG4gICAgdmFsdWVNaXNzaW5nOiBcIkl0J3MgbmVjZXNzYXJ5IHRvIHdyaXRlIGVtYWlsXCIsXG4gICAgdHlwZU1pc21hdGNoOiBcIkl0J3Mgbm90IGVtYWlsIVwiLFxuICB9LFxuICBuYW1lOiB7XG4gICAgdmFsdWVNaXNzaW5nOiBcIkl0J3MgbmVjZXNzYXJ5IHRvIHdyaXRlIHRleHRcIixcbiAgfSxcbiAgY29zdDoge1xuICAgIHZhbHVlTWlzc2luZzogXCJJdCdzIG5lY2Vzc2FyeSB0byB3cml0ZSBjb3N0XCIsXG4gICAgcmFuZ2VVbmRlcmZsb3c6ICdFbnRlciBhIG51bWJlciBncmVhdGVyIHRoYW4gMCcsXG4gIH0sXG59O1xuXG5leHBvcnQgZGVmYXVsdCBtZXNzYWdlcztcbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZURhdGEoYXJyYXksIG8pIHtcbiAgYXJyYXkuZm9yRWFjaCgoZWwpID0+IHtcbiAgICBjb25zdCBrZXkgPSBlbC5kYXRhc2V0ID8gZWwuZGF0YXNldC5pZCA6IG51bGw7XG4gICAgY29uc3QgeyB2YWx1ZSB9ID0gZWw7XG5cbiAgICBpZiAoIWtleSkgcmV0dXJuO1xuICAgIC8qIGVzbGludC1kaXNhYmxlICovXG4gICAgb1trZXldID0gdmFsdWU7XG4gIH0pO1xufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvZHVjdCB7XG4gIGNvbnN0cnVjdG9yKGRhdGEsIGNvbnRhaW5lcikge1xuICAgIHRoaXMucm93ID0gY29udGFpbmVyO1xuICAgIHRoaXMuZGF0YVByb2R1Y3QgPSBkYXRhO1xuICAgIHRoaXMuYmluZFRvRE9NKCk7XG4gIH1cblxuICBiaW5kVG9ET00oKSB7XG4gICAgdGhpcy5yb3cuaW5uZXJIVE1MID0gYFxuICAgIDx0aCBjbGFzcz1cInByb2R1Y3QtbmFtZVwiPiR7dGhpcy5kYXRhUHJvZHVjdC5uYW1lfTwvdGg+XG4gICAgPHRoIGNsYXNzPVwicHJvZHVjdC1jb3N0XCI+JHsrdGhpcy5kYXRhUHJvZHVjdC5jb3N0fTwvdGg+XG4gICAgPHRoPjxzcGFuIGNsYXNzPVwidXBkYXRlXCI+4pyOPC9zcGFuPjxzcGFuIGNsYXNzPVwiZGVsZXRlXCI+4pyWPC9zcGFuPjwvdGg+XG4gICAgYDtcbiAgfVxuXG4gIGV2ZW50cyhjb250YWluZXIpIHtcbiAgICBjb25zdCB1cGRhdGVCdG4gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLnVwZGF0ZScpO1xuICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZGVsZXRlJyk7XG5cbiAgICB1cGRhdGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLnVwZGF0ZSh0aGlzLmRhdGFQcm9kdWN0KSk7XG4gICAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5kZWxldGUoKSk7XG4gIH1cblxuICAvKiBlc2xpbnQtZGlzYWJsZSAqL1xuICB1cGRhdGUoZGF0YSkge1xuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXRvci1mb3JtXCIpO1xuICAgIGZvcm0uc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBkYXRhLmlkKTtcblxuICAgIGZvcm1cbiAgICAgIC5jbG9zZXN0KFwiLmVkaXRvci1mb3JtLWNvbnRhaW5lclwiKVxuICAgICAgLmNsYXNzTGlzdC5hZGQoXCJlZGl0b3ItZm9ybS1jb250YWluZXJfdmlzaWJsZVwiKTtcbiAgICBjb25zdCBuYW1lSW5wdXQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWlkPVwibmFtZVwiXScpO1xuICAgIGNvbnN0IGNvc3RJbnB1dCA9IGZvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtaWQ9XCJjb3N0XCJdJyk7XG4gICAgbmFtZUlucHV0LnZhbHVlID0gZGF0YS5uYW1lO1xuICAgIGNvc3RJbnB1dC52YWx1ZSA9IGRhdGEuY29zdDtcbiAgfVxuXG4gIGRlbGV0ZSgpIHtcbiAgICB0aGlzLl9kZWxldGVNZXNzYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kZWxldGUtbWVzc2FnZVwiKTtcbiAgICB0aGlzLl9kZWxldGVNZXNzYWdlLmNsYXNzTGlzdC5hZGQoXCJkZWxldGUtbWVzc2FnZV92aXNpYmxlXCIpO1xuICAgIHRoaXMuX2RlbGV0ZU1lc3NhZ2Uuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCB0aGlzLmRhdGFQcm9kdWN0LmlkKTtcbiAgICBcbiAgICBjb25zdCB0Ym9keVJlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0Ym9keScpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHRoaXMuX2RlbGV0ZU1lc3NhZ2Uuc3R5bGUubGVmdCA9IGAke3Rib2R5UmVjdC5sZWZ0ICsgd2luZG93LnNjcm9sbFggKyB0Ym9keVJlY3Qud2lkdGggLyAyIC0gdGhpcy5fZGVsZXRlTWVzc2FnZS5vZmZzZXRXaWR0aCAvIDJ9cHhgO1xuICAgIHRoaXMuX2RlbGV0ZU1lc3NhZ2Uuc3R5bGUudG9wID0gYCR7dGJvZHlSZWN0LnRvcCArIHdpbmRvdy5zY3JvbGxZfXB4YDtcbiAgfVxuXG4gIG1hcmtVcCgpIHtcbiAgICByZXR1cm4gdGhpcy5yb3cuaW5uZXJIVE1MO1xuICB9XG59XG4iLCJjb25zdCBwcm9kdWN0c0FycmF5ID0gW107XG5leHBvcnQgZGVmYXVsdCBwcm9kdWN0c0FycmF5O1xuIiwiaW1wb3J0ICcuL3Rvb2x0aXAuY3NzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVG9vbHRpcCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX3Rvb2x0aXBzID0gW107XG4gIH1cblxuICBzaG93VG9vbHRpcChtZXNzYWdlLCBlbGVtZW50KSB7XG4gICAgY29uc3QgdG9vbHRpcEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdESVYnKTtcblxuICAgIHRvb2x0aXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Zvcm0tZXJyb3InKTtcbiAgICB0b29sdGlwRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG5cbiAgICBjb25zdCBpZCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgdGhpcy5fdG9vbHRpcHMucHVzaCh7XG4gICAgICBpZCxcbiAgICAgIGVsZW1lbnQ6IHRvb2x0aXBFbGVtZW50LFxuICAgIH0pO1xuXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0b29sdGlwRWxlbWVudCk7XG5cbiAgICBjb25zdCB7IGxlZnQsIGJvdHRvbSB9ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIHRvb2x0aXBFbGVtZW50LnN0eWxlLmxlZnQgPSBgJHt3aW5kb3cuc2Nyb2xsWCArIGxlZnR9cHhgO1xuICAgIHRvb2x0aXBFbGVtZW50LnN0eWxlLnRvcCA9IGAke2JvdHRvbSArIDV9cHhgO1xuXG4gICAgcmV0dXJuIGlkO1xuICB9XG5cbiAgcmVtb3ZlVG9vbHRpcChpZCkge1xuICAgIGNvbnN0IHRvb2x0aXAgPSB0aGlzLl90b29sdGlwcy5maW5kKCh0KSA9PiB0LmlkID09PSBpZCk7XG5cbiAgICB0b29sdGlwLmVsZW1lbnQucmVtb3ZlKCk7XG5cbiAgICB0aGlzLl90b29sdGlwcyA9IHRoaXMuX3Rvb2x0aXBzLmZpbHRlcigodCkgPT4gdC5pZCAhPT0gaWQpO1xuICB9XG59XG4iLCJjb25zdCBnZXRFcnJvciA9IChlbCwgZXJyb3JzKSA9PiB7XG4gIGNvbnN0IGVycm9yS2V5ID0gT2JqZWN0LmtleXMoVmFsaWRpdHlTdGF0ZS5wcm90b3R5cGUpLmZpbmQoKGtleSkgPT4ge1xuICAgIGlmICghZWwubmFtZSkgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChrZXkgPT09ICd2YWxpZCcpIHJldHVybiBmYWxzZTtcblxuICAgIHJldHVybiBlbC52YWxpZGl0eVtrZXldO1xuICB9KTtcblxuICBpZiAoIWVycm9yS2V5KSByZXR1cm4gZmFsc2U7XG5cbiAgcmV0dXJuIGVycm9yc1tlbC5uYW1lXVtlcnJvcktleV07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBnZXRFcnJvcjtcbiIsImltcG9ydCBtZXNzYWdlcyBmcm9tICcuL21lc3NhZ2VzJztcbmltcG9ydCBjcmVhdGVEYXRhIGZyb20gJy4uL2NyZWF0ZURhdGEnO1xuaW1wb3J0IFByb2R1Y3QgZnJvbSAnLi4vUHJvZHVjdCc7XG5pbXBvcnQgcHJvZHVjdHNBcnJheSBmcm9tICcuLi9wcm9kdWN0c0FycmF5JztcblxuaW1wb3J0ICcuL2VkaXRvci1mb3JtLmNzcyc7XG5pbXBvcnQgVG9vbHRpcCBmcm9tICcuLi9Ub29sdGlwL1Rvb2x0aXAnO1xuaW1wb3J0IGdldEVycm9yIGZyb20gJy4uL1Rvb2x0aXAvZ2V0RXJyb3InO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFZGl0b3JGb3JtIHtcbiAgY29uc3RydWN0b3IoY29udGFpbmVyKSB7XG4gICAgdGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgIHRoaXMuX2Zvcm1Db250YWluZXIgPSBudWxsO1xuICAgIHRoaXMuX2Vycm9yRWxlbWVudCA9IG51bGw7XG4gICAgdGhpcy5fZm9ybSA9IG51bGw7XG4gICAgdGhpcy5fdG9vbHRpcEZhY3RvcnkgPSBuZXcgVG9vbHRpcCgpO1xuXG4gICAgdGhpcy5wcm9kdWN0c0FycmF5ID0gW107XG4gICAgdGhpcy5hY3R1YWxNZXNzYWdlcyA9IFtdO1xuICB9XG5cbiAgYmluZFRvRE9NKGRhdGEpIHtcbiAgICB0aGlzLmNyZWF0ZUZvcm1Db250YWluZXIoZGF0YSB8fCB7IG5hbWU6ICcnLCBjb3N0OiAnJyB9KTtcbiAgICB0aGlzLnNldEV2ZW50cygpO1xuICB9XG5cbiAgY3JlYXRlRm9ybUNvbnRhaW5lcihkYXRhKSB7XG4gICAgdGhpcy5fZm9ybUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuX2Zvcm1Db250YWluZXIuY2xhc3NMaXN0LmFkZCgnZWRpdG9yLWZvcm0tY29udGFpbmVyJyk7XG4gICAgdGhpcy5zZXRGb3JtRGF0YShkYXRhKTtcbiAgICB0aGlzLl9mb3JtQ29udGFpbmVyLmlubmVySFRNTCA9IEVkaXRvckZvcm0uZm9ybU1hcmt1cCh0aGlzLmZvcm1EYXRhKTtcbiAgICB0aGlzLl9jb250YWluZXIuYXBwZW5kKHRoaXMuX2Zvcm1Db250YWluZXIpO1xuICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9jb250YWluZXIucXVlcnlTZWxlY3RvcignI2VkaXRvci1mb3JtJyk7XG4gICAgdGhpcy5fZXJyb3JFbGVtZW50ID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5lZGl0b3ItZm9ybS1lcnJvcicpO1xuICB9XG5cbiAgc2V0Rm9ybURhdGEoZGF0YSkge1xuICAgIHRoaXMuZm9ybURhdGEgPSBkYXRhO1xuICB9XG5cbiAgc2V0RXZlbnRzKCkge1xuICAgIGNvbnN0IGNsb3NlQnRuID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS10b2dnbGU9XCJlZGl0b3ItY2xvc2VcIl0nKTtcblxuICAgIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5jbG9zZUZvcm0oKSk7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4gdGhpcy5vblN1Ym1pdChlKSk7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+IHt9LCB0cnVlKTtcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoZSkgPT4gdGhpcy5lbGVtZW50T25CbHVyKGUpLCB0cnVlKTtcbiAgfVxuXG4gIGVsZW1lbnRPbkJsdXIoZSkge1xuICAgIGNvbnN0IGVsID0gZS50YXJnZXQ7XG4gICAgY29uc3QgZXJyb3IgPSBnZXRFcnJvcihlbCwgbWVzc2FnZXMpO1xuXG4gICAgY29uc3QgbWVzc2FnZUluZGV4ID0gdGhpcy5hY3R1YWxNZXNzYWdlcy5maW5kSW5kZXgoXG4gICAgICAoaXRlbSkgPT4gaXRlbS5uYW1lID09PSBlbC5uYW1lLFxuICAgICk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChtZXNzYWdlSW5kZXggPT09IC0xKSB7XG4gICAgICAgIHRoaXMuc2hvd1Rvb2x0aXAoZXJyb3IsIGVsKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKG1lc3NhZ2VJbmRleCAhPT0gLTEpIHtcbiAgICAgIHRoaXMuX3Rvb2x0aXBGYWN0b3J5LnJlbW92ZVRvb2x0aXAoXG4gICAgICAgIHRoaXMuYWN0dWFsTWVzc2FnZXNbbWVzc2FnZUluZGV4XS5pZCxcbiAgICAgICk7XG4gICAgICB0aGlzLmFjdHVhbE1lc3NhZ2VzLnNwbGljZShtZXNzYWdlSW5kZXgsIDEpO1xuICAgIH1cbiAgfVxuXG4gIGNsb3NlRm9ybSgpIHtcbiAgICBpZiAodGhpcy5fZm9ybS5kYXRhc2V0LmlkKSB0aGlzLl9mb3JtLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuXG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICAgIHRoaXMuX2Zvcm1Db250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnZWRpdG9yLWZvcm0tY29udGFpbmVyX3Zpc2libGUnKTtcbiAgfVxuXG4gIG9uU3VibWl0KGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5oYW5kbGVWYWxpZGF0aW9uKCk7XG4gIH1cblxuICBoYW5kbGVWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuZm9ybUVsZW1lbnRzID0gWy4uLnRoaXMuX2Zvcm0uZWxlbWVudHNdO1xuXG4gICAgdGhpcy5hY3R1YWxNZXNzYWdlcy5mb3JFYWNoKChtZXNzYWdlKSA9PiB0aGlzLl90b29sdGlwRmFjdG9yeS5yZW1vdmVUb29sdGlwKG1lc3NhZ2UuaWQpKTtcblxuICAgIHRoaXMuYWN0dWFsTWVzc2FnZXMgPSBbXTtcblxuICAgIGlmICghdGhpcy5fZm9ybS5jaGVja1ZhbGlkaXR5KCkpIHtcbiAgICAgIHRoaXMuc2hvd0Vycm9ycygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb2Nlc3NGb3JtRGF0YSgpO1xuICAgIH1cbiAgfVxuXG4gIHNob3dFcnJvcnMoKSB7XG4gICAgdGhpcy5mb3JtRWxlbWVudHMuZm9yRWFjaCgoZWxlbSkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBnZXRFcnJvcihlbGVtLCBtZXNzYWdlcyk7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5zaG93VG9vbHRpcChlcnJvciwgZWxlbSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcm9jZXNzRm9ybURhdGEoKSB7XG4gICAgaWYgKHRoaXMuX2Zvcm0uZGF0YXNldC5pZCkge1xuICAgICAgdGhpcy51cGRhdGVQcm9kdWN0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3JlYXRlUHJvZHVjdCgpO1xuICAgIH1cbiAgICB0aGlzLmNsb3NlRm9ybSgpO1xuICB9XG5cbiAgdXBkYXRlUHJvZHVjdCgpIHtcbiAgICBjb25zdCBpZCA9ICt0aGlzLl9mb3JtLmRhdGFzZXQuaWQ7XG4gICAgY29uc3QgaW5kZXggPSBwcm9kdWN0c0FycmF5LmZpbmRJbmRleCgoZWwpID0+IGVsLmlkID09PSBpZCk7XG4gICAgY29uc3QgcHJvZHVjdERhdGEgPSBwcm9kdWN0c0FycmF5W2luZGV4XTtcblxuICAgIGNyZWF0ZURhdGEodGhpcy5mb3JtRWxlbWVudHMsIHByb2R1Y3REYXRhKTtcblxuICAgIGNvbnN0IHByb2R1Y3QgPSB0aGlzLl9jb250YWluZXIucXVlcnlTZWxlY3RvcihgW2RhdGEtcm93PVwiJHtpZH1cIl1gKTtcbiAgICBwcm9kdWN0LnF1ZXJ5U2VsZWN0b3IoJy5wcm9kdWN0LW5hbWUnKS5pbm5lclRleHQgPSBwcm9kdWN0RGF0YS5uYW1lO1xuICAgIHByb2R1Y3QucXVlcnlTZWxlY3RvcignLnByb2R1Y3QtY29zdCcpLmlubmVyVGV4dCA9IHByb2R1Y3REYXRhLmNvc3Q7XG4gIH1cblxuICBjcmVhdGVQcm9kdWN0KCkge1xuICAgIGNvbnN0IGZvcm1EYXRhID0ge307XG4gICAgY3JlYXRlRGF0YSh0aGlzLmZvcm1FbGVtZW50cywgZm9ybURhdGEpO1xuXG4gICAgZm9ybURhdGEuaWQgPSBEYXRlLm5vdygpO1xuXG4gICAgY29uc3QgdGFibGVCb2R5ID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5Jyk7XG4gICAgY29uc3QgdGFibGVSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgIGNvbnN0IHByb2R1Y3QgPSBuZXcgUHJvZHVjdChmb3JtRGF0YSwgdGFibGVSb3cpO1xuXG4gICAgcHJvZHVjdHNBcnJheS5wdXNoKHByb2R1Y3QuZGF0YVByb2R1Y3QpO1xuXG4gICAgdGFibGVSb3cuY2xhc3NMaXN0LmFkZCgncHJvZHVjdC1yb3cnKTtcbiAgICB0YWJsZVJvdy5pbm5lckhUTUwgPSBwcm9kdWN0Lm1hcmtVcCgpO1xuICAgIHRhYmxlUm93LnNldEF0dHJpYnV0ZSgnZGF0YS1yb3cnLCBmb3JtRGF0YS5pZCk7XG4gICAgcHJvZHVjdC5ldmVudHModGFibGVSb3cpO1xuICAgIHRhYmxlQm9keS5hcHBlbmQodGFibGVSb3cpO1xuICB9XG5cbiAgc2hvd1Rvb2x0aXAobWVzc2FnZSwgZWwpIHtcbiAgICB0aGlzLmFjdHVhbE1lc3NhZ2VzLnB1c2goe1xuICAgICAgbmFtZTogZWwubmFtZSxcbiAgICAgIGlkOiB0aGlzLl90b29sdGlwRmFjdG9yeS5zaG93VG9vbHRpcChtZXNzYWdlLCBlbCksXG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgZm9ybU1hcmt1cChmb3JtRGF0YSkge1xuICAgIHJldHVybiBgXG4gICAgICAgICAgICA8Zm9ybSBpZD1cImVkaXRvci1mb3JtXCIgbm92YWxpZGF0ZT5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1jb250cm9sIGZvcm0tZWRpdG9yXCI+XG4gICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJsYWJlbC1lZGl0b3JcIiBmb3I9XCJuYW1lXCI+0J3QsNC30LLQsNC90LjQtTwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICA8aW5wdXQgbmFtZT1cIm5hbWVcIiBkYXRhLWlkPVwibmFtZVwiIGNsYXNzPVwiaW5wdXQgaW5wdXQtZWRpdG9yXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cInByb2R1Y3QgbmFtZVwiIGF1dG9jb21wbGV0ZT1cIm9mZlwiIHZhbHVlPVwiJHtmb3JtRGF0YS5uYW1lfVwiIHJlcXVpcmVkPiBcbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1jb250cm9sIGZvcm0tZWRpdG9yXCI+XG4gICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPVwiY29zdFwiIGNsYXNzPVwibGFiZWwtZWRpdG9yXCI+0KHRgtC+0LjQvNC+0YHRgtGMPC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgIDxpbnB1dCBuYW1lPVwiY29zdFwiIGRhdGEtaWQ9XCJjb3N0XCIgY2xhc3M9XCJpbnB1dCBpbnB1dC1lZGl0b3JcIiB0eXBlPVwibnVtYmVyXCIgbWluPVwiMVwiIHBsYWNlaG9sZGVyPVwicHJvZHVjdCBjb3N0XCIgYXV0b2NvbXBsZXRlPVwib2ZmXCIgdmFsdWU9XCIke2Zvcm1EYXRhLmNvc3R9XCIgcmVxdWlyZWQ+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZWRpdG9yLWJ0blwiPlxuICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgY2xhc3M9XCJidG4gYnRuLWFkZFwiIGRhdGEtdG9nZ2xlPVwiZWRpdG9yLWFkZFwiIHRpdGxlPVwiU3VibWl0IGVkaXRvciBmb3JtXCI+0KHQvtGF0YDQsNC90LjRgtGMPC9idXR0b24+XG4gICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tY2xvc2VcIiBkYXRhLXRvZ2dsZT1cImVkaXRvci1jbG9zZVwiIHRpdGxlPVwiQ2xvc2UgZWRpdG9yIGZvcm1cIj7Ql9Cw0LrRgNGL0YLRjDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgICAgYDtcbiAgfVxufVxuIiwiaW1wb3J0ICcuL3BvcG92ZXIuY3NzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wb3ZlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IG51bGw7XG4gIH1cblxuICBiaW5kVG9ET00oY29udGFpbmVyKSB7XG4gICAgdGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgIHRoaXMuZHJhd1VpKCk7XG4gICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgZHJhd1VpKCkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKCkpIHJldHVybjtcblxuICAgIHRoaXMuX2NvbnRhaW5lci5pbm5lckhUTUwgPSBQb3BvdmVyLm1hcmtVcDtcbiAgfVxuXG4gIGlzQm91bmQoKSB7XG4gICAgaWYgKHRoaXMuX2NvbnRhaW5lciA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKCkpIHJldHVybjtcblxuICAgIGNvbnN0IHBvcG92ZXJCdXR0b24gPSB0aGlzLl9jb250YWluZXIucXVlcnlTZWxlY3RvcignLmJ0bicpO1xuICAgIHBvcG92ZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gdGhpcy5vbkNsaWNrKGUpKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgbWFya1VwKCkge1xuICAgIHJldHVybiBgXG4gICAgICA8ZGl2IGNsYXNzPVwid3JhcHBlci1idG5cIj5cbiAgICAgICAgPGEgdGFiaW5kZXg9XCIwXCIgcm9sZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuXCIgZGF0YS10b2dnbGU9XCJwb3BvdmVyXCIgdGl0bGU9XCJQb3BvdmVyIHRpdGxlXCIgZGF0YS1jb250ZW50PVwiQW5kIGhlcmUncyBzb21lIGFtYXppbmcgY29udGVudD9cIj5DbGljayB0byB0b2dnbGUgcG9wb3ZlcjwvYT5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cInBvcG92ZXItbWVzc2FnZVwiPlxuICAgICAgICA8aDMgY2xhc3M9XCJwb3BvdmVyLXRpdGxlXCI+UG9wb3ZlciB0aXRsZTwvaDM+XG4gICAgICAgIDxwIGNsYXNzPVwicG9wb3Zlci10ZXh0XCI+QW5kIGhlcmUncyBzb21lIGFtYXppbmcgY29udGVudC4gSXQncyB2ZXJ5IGVuZ2FnaW5nLiBSaWdodD9cIjwvcD5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG4gIH1cblxuICBvbkNsaWNrKGUpIHtcbiAgICB0aGlzLnBvcG92ZXJNZXNzYWdlID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5wb3BvdmVyLW1lc3NhZ2UnKTtcbiAgICB0aGlzLnBvcG92ZXJNZXNzYWdlLmNsYXNzTGlzdC50b2dnbGUoJ3BvcG92ZXItbWVzc2FnZV92aXNpYmxlJyk7XG4gICAgdGhpcy5wb3NpdGlvblBvcG92ZXJNZXNzYWdlKGUpO1xuICB9XG5cbiAgcG9zaXRpb25Qb3BvdmVyTWVzc2FnZShlKSB7XG4gICAgY29uc3QgY29vcmRzID0gZS5jdXJyZW50VGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IHBvcG92ZXJNZXNzYWdlUmVjdCA9IHRoaXMucG9wb3Zlck1lc3NhZ2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICBjb25zdCBsZWZ0ID0gY29vcmRzLmxlZnQgKyBjb29yZHMud2lkdGggLyAyIC0gcG9wb3Zlck1lc3NhZ2VSZWN0LndpZHRoIC8gMiArIHdpbmRvdy5zY3JvbGxYO1xuICAgIGNvbnN0IHRvcCA9IGNvb3Jkcy50b3AgLSBwb3BvdmVyTWVzc2FnZVJlY3QuaGVpZ2h0IC0gMjAgKyB3aW5kb3cuc2Nyb2xsWTtcblxuICAgIHRoaXMucG9wb3Zlck1lc3NhZ2Uuc3R5bGUubGVmdCA9IGAke2xlZnR9cHhgO1xuICAgIHRoaXMucG9wb3Zlck1lc3NhZ2Uuc3R5bGUudG9wID0gYCR7dG9wfXB4YDtcbiAgfVxufVxuIiwiaW1wb3J0IEVkaXRvciBmcm9tICcuL0VkaXRvci9FZGl0b3InO1xuaW1wb3J0IFBvcG92ZXIgZnJvbSAnLi9Qb3BvdmVyL1BvcG92ZXInO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xuY29uc29sZS5sb2coJ2l0IHdvcmtzIScpO1xuXG4vLyB0aGUgZmlyc3QgdGFzayBhYm91dCBQb3BvdmVyXG5jb25zdCBwb3BvdmVyID0gbmV3IFBvcG92ZXIoKTtcbnBvcG92ZXIuYmluZFRvRE9NKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwb3BvdmVyLWNvbnRhaW5lcicpKTtcblxuLy8gdGhlIHNlY29uZCB0YXNrIGFib3V0IEVkaXRvclxuY29uc3QgZWRpdG9yID0gbmV3IEVkaXRvcigpO1xuZWRpdG9yLmJpbmRUb0RPTShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZWRpdG9yLWNvbnRhaW5lcicpKVxuXG4iLCJpbXBvcnQgRWRpdG9yRm9ybSBmcm9tICcuL0VkaXRvckZvcm0vRWRpdG9yRm9ybSc7XG5pbXBvcnQgcHJvZHVjdHNBcnJheSBmcm9tICcuL3Byb2R1Y3RzQXJyYXknO1xuXG5pbXBvcnQgJy4vZWRpdG9yLmNzcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVkaXRvciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IG51bGw7XG4gICAgdGhpcy5lZGl0b3JGb3JtID0gbnVsbDtcbiAgICB0aGlzLmRlbGV0ZU1lc3NhZ2UgPSBudWxsO1xuICAgIHRoaXMucHJvZHVjdHMgPSBwcm9kdWN0c0FycmF5O1xuICB9XG5cbiAgYmluZFRvRE9NKGNvbnRhaW5lcikge1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjtcblxuICAgIHRoaXMuZHJhd1VpKCk7XG4gICAgdGhpcy5ldmVudHMoKTtcbiAgfVxuXG4gIGRyYXdVaSgpIHtcbiAgICB0aGlzLmNoZWNrQmluZGluZygpO1xuXG4gICAgdGhpcy5fY29udGFpbmVyLmlubmVySFRNTCA9IGBcbiAgICAgIDx0YWJsZSBjbGFzcz1cInRhYmxlXCI+XG4gICAgICAgIDxjYXB0aW9uIGNsYXNzPVwidGl0bGUtdGFibGVcIj5NeSBlZGl0b3I8L2NhcHRpb24+XG4gICAgICAgIDx0aGVhZD5cbiAgICAgICAgICA8dHIgY2xhc3M9XCJwcm9kdWN0c1wiPlxuICAgICAgICAgICAgPHRoICBjb2xzcGFuPVwiMlwiIHN0eWxlPVwidGV4dC1hbGlnbjpsZWZ0XCI+0KLQvtCy0LDRgNGLPC90aD5cbiAgICAgICAgICAgIDx0aCBzdHlsZT1cInRleHQtYWxpZ246cmlnaHRcIiBkYXRhLWlkPVwiYWRkXCI+PHNwYW4gY2xhc3M9XCJhZGRcIj7inJk8L3NwYW4+PC90aD5cbiAgICAgICAgICA8L3RyPlxuICAgICAgICAgIDx0ciBjbGFzcz1cInByb2R1Y3QtdGFibGVcIj5cbiAgICAgICAgICAgIDx0aD7QndCw0LfQstCw0L3QuNC1PC90aD5cbiAgICAgICAgICAgIDx0aD7QodGC0L7QuNC80L7RgdGC0Yw8L3RoPlxuICAgICAgICAgICAgPHRoPtCU0LXQudGB0YLQstC40Y88L3RoPlxuICAgICAgICAgIDwvdHI+XG4gICAgICAgIDwvdGhlYWQ+XG4gICAgICAgIDx0Ym9keT48L3Rib2R5PlxuICAgICAgPC90YWJsZT5cbiAgICAgIDxkaXYgY2xhc3M9XCJkZWxldGUtbWVzc2FnZVwiPlxuICAgICAgICA8aDI+0JLRiyDQtNC10LnRgdGC0LLQuNGC0LXQu9GM0L3QviDRhdC+0YLQuNGC0LUg0YPQtNCw0LvQuNGC0Ywg0YLQvtCy0LDRgD88L2gyPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZWRpdG9yLWJ0blwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1hZGRcIiBkYXRhLXRvZ2dsZT1cImRlbGV0ZS1wcm9kdWN0XCIgdGl0bGU9XCJCdXR0b24gZm9yIGRlbGV0ZSBwcm9kdWN0XCI+0JTQsDwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1jbG9zZVwiIGRhdGEtdG9nZ2xlPVwiY2xvc2UtbWVzc2FnZVwiIHRpdGxlPVwiQ2xvc2UgZGVsZXRlIG1lc3NhZ2VcIj7QndC10YI8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIGA7XG5cbiAgICBjb25zdCBlZGl0b3JGb3JtID0gbmV3IEVkaXRvckZvcm0odGhpcy5fY29udGFpbmVyKTtcbiAgICBlZGl0b3JGb3JtLmJpbmRUb0RPTSgpO1xuXG4gICAgdGhpcy5lZGl0b3JGb3JtID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5lZGl0b3ItZm9ybS1jb250YWluZXInKTtcbiAgICB0aGlzLmRlbGV0ZU1lc3NhZ2UgPSB0aGlzLl9jb250YWluZXIucXVlcnlTZWxlY3RvcignLmRlbGV0ZS1tZXNzYWdlJyk7XG4gIH1cblxuICBjaGVja0JpbmRpbmcoKSB7XG4gICAgaWYgKHRoaXMuX2NvbnRhaW5lciA9PT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3JtIG5vdCBiaW5kIHRvIERPTScpO1xuICAgIH1cbiAgfVxuXG4gIGV2ZW50cygpIHtcbiAgICBjb25zdCBhZGRFbCA9IHRoaXMuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1cImFkZFwiXScpO1xuICAgIGNvbnN0IGRlbGV0ZVByb2R1Y3QgPSB0aGlzLl9jb250YWluZXIucXVlcnlTZWxlY3RvcihcbiAgICAgICdbZGF0YS10b2dnbGU9XCJkZWxldGUtcHJvZHVjdFwiXScsXG4gICAgKTtcbiAgICBjb25zdCBjbG9zZU1lc3NhZ2UgPSB0aGlzLl9jb250YWluZXIucXVlcnlTZWxlY3RvcihcbiAgICAgICdbZGF0YS10b2dnbGU9XCJjbG9zZS1tZXNzYWdlXCJdJyxcbiAgICApO1xuXG4gICAgYWRkRWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLnNob3dGb3JtKCkpO1xuICAgIGRlbGV0ZVByb2R1Y3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gdGhpcy5kZWxldGVQcm9kdWN0KGUpKTtcbiAgICBjbG9zZU1lc3NhZ2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLmNsb3NlTWVzc2FnZSgpKTtcbiAgfVxuXG4gIHNob3dGb3JtKCkge1xuICAgIHRoaXMuZWRpdG9yRm9ybS5jbGFzc0xpc3QuYWRkKCdlZGl0b3ItZm9ybS1jb250YWluZXJfdmlzaWJsZScpO1xuXG4gICAgY29uc3QgY29vcmRzID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5JykuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdGhpcy5lZGl0b3JGb3JtLnN0eWxlLmxlZnQgPSBgJHtjb29yZHMubGVmdCArIHdpbmRvdy5zY3JvbGxYICsgY29vcmRzLndpZHRoIC8gMiAtIHRoaXMuZWRpdG9yRm9ybS5vZmZzZXRXaWR0aCAvIDJ9cHhgO1xuICAgIHRoaXMuZWRpdG9yRm9ybS5zdHlsZS50b3AgPSBgJHtjb29yZHMudG9wICsgd2luZG93LnNjcm9sbFl9cHhgO1xuICB9XG5cbiAgZGVsZXRlUHJvZHVjdCgpIHtcbiAgICBjb25zdCBpbmRleCA9IHByb2R1Y3RzQXJyYXkuZmluZEluZGV4KFxuICAgICAgKGVsKSA9PiBlbC5pZCA9PT0gK3RoaXMuZGVsZXRlTWVzc2FnZS5kYXRhc2V0LmlkLFxuICAgICk7XG4gICAgcHJvZHVjdHNBcnJheS5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgY29uc3QgcHJvZHVjdCA9IHRoaXMuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFxuICAgICAgYFtkYXRhLXJvdz1cIiR7dGhpcy5kZWxldGVNZXNzYWdlLmRhdGFzZXQuaWR9XCJdYCxcbiAgICApO1xuICAgIHByb2R1Y3QucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChwcm9kdWN0KTtcbiAgICB0aGlzLmNsb3NlTWVzc2FnZSgpO1xuICB9XG5cbiAgY2xvc2VNZXNzYWdlKCkge1xuICAgIHRoaXMuZGVsZXRlTWVzc2FnZS5jbGFzc0xpc3QucmVtb3ZlKCdkZWxldGUtbWVzc2FnZV92aXNpYmxlJyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwb3BvdmVyIiwidmFsdWVNaXNzaW5nIiwiZW1haWwiLCJ0eXBlTWlzbWF0Y2giLCJuYW1lIiwiY29zdCIsInJhbmdlVW5kZXJmbG93IiwiY3JlYXRlRGF0YSIsImFycmF5IiwibyIsImZvckVhY2giLCJlbCIsImtleSIsImRhdGFzZXQiLCJpZCIsInZhbHVlIiwiUHJvZHVjdCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNvbnRhaW5lciIsInRoaXMiLCJyb3ciLCJkYXRhUHJvZHVjdCIsImJpbmRUb0RPTSIsImlubmVySFRNTCIsImV2ZW50cyIsInVwZGF0ZUJ0biIsInF1ZXJ5U2VsZWN0b3IiLCJkZWxldGVCdG4iLCJhZGRFdmVudExpc3RlbmVyIiwidXBkYXRlIiwiZGVsZXRlIiwiZm9ybSIsImRvY3VtZW50Iiwic2V0QXR0cmlidXRlIiwiY2xvc2VzdCIsImNsYXNzTGlzdCIsImFkZCIsIm5hbWVJbnB1dCIsImNvc3RJbnB1dCIsIl9kZWxldGVNZXNzYWdlIiwidGJvZHlSZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0Iiwic3R5bGUiLCJsZWZ0Iiwid2luZG93Iiwic2Nyb2xsWCIsIndpZHRoIiwib2Zmc2V0V2lkdGgiLCJ0b3AiLCJzY3JvbGxZIiwibWFya1VwIiwiVG9vbHRpcCIsIl90b29sdGlwcyIsInNob3dUb29sdGlwIiwibWVzc2FnZSIsImVsZW1lbnQiLCJ0b29sdGlwRWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0ZXh0Q29udGVudCIsInBlcmZvcm1hbmNlIiwibm93IiwicHVzaCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImJvdHRvbSIsInJlbW92ZVRvb2x0aXAiLCJmaW5kIiwidCIsInJlbW92ZSIsImZpbHRlciIsImdldEVycm9yIiwiZXJyb3JzIiwiZXJyb3JLZXkiLCJPYmplY3QiLCJrZXlzIiwiVmFsaWRpdHlTdGF0ZSIsInByb3RvdHlwZSIsInZhbGlkaXR5IiwiRWRpdG9yRm9ybSIsIl9jb250YWluZXIiLCJfZm9ybUNvbnRhaW5lciIsIl9lcnJvckVsZW1lbnQiLCJfZm9ybSIsIl90b29sdGlwRmFjdG9yeSIsInByb2R1Y3RzQXJyYXkiLCJhY3R1YWxNZXNzYWdlcyIsImNyZWF0ZUZvcm1Db250YWluZXIiLCJzZXRFdmVudHMiLCJzZXRGb3JtRGF0YSIsImZvcm1NYXJrdXAiLCJmb3JtRGF0YSIsImFwcGVuZCIsImNsb3NlRm9ybSIsImUiLCJvblN1Ym1pdCIsImVsZW1lbnRPbkJsdXIiLCJ0YXJnZXQiLCJlcnJvciIsIm1lc3NhZ2VzIiwibWVzc2FnZUluZGV4IiwiZmluZEluZGV4IiwiaXRlbSIsInNwbGljZSIsInJlbW92ZUF0dHJpYnV0ZSIsInJlc2V0IiwicHJldmVudERlZmF1bHQiLCJoYW5kbGVWYWxpZGF0aW9uIiwiZm9ybUVsZW1lbnRzIiwiZWxlbWVudHMiLCJjaGVja1ZhbGlkaXR5IiwicHJvY2Vzc0Zvcm1EYXRhIiwic2hvd0Vycm9ycyIsImVsZW0iLCJ1cGRhdGVQcm9kdWN0IiwiY3JlYXRlUHJvZHVjdCIsImluZGV4IiwicHJvZHVjdERhdGEiLCJwcm9kdWN0IiwiaW5uZXJUZXh0IiwiRGF0ZSIsInRhYmxlQm9keSIsInRhYmxlUm93IiwiUG9wb3ZlciIsImRyYXdVaSIsInNldEV2ZW50TGlzdGVuZXJzIiwiaXNCb3VuZCIsIm9uQ2xpY2siLCJwb3BvdmVyTWVzc2FnZSIsInRvZ2dsZSIsInBvc2l0aW9uUG9wb3Zlck1lc3NhZ2UiLCJjb29yZHMiLCJjdXJyZW50VGFyZ2V0IiwicG9wb3Zlck1lc3NhZ2VSZWN0IiwiaGVpZ2h0IiwiY29uc29sZSIsImxvZyIsImVkaXRvckZvcm0iLCJkZWxldGVNZXNzYWdlIiwicHJvZHVjdHMiLCJjaGVja0JpbmRpbmciLCJFcnJvciIsImFkZEVsIiwiZGVsZXRlUHJvZHVjdCIsImNsb3NlTWVzc2FnZSIsInNob3dGb3JtIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIl0sInNvdXJjZVJvb3QiOiIifQ==